{
    "id": "T1546.013",
    "name": "PowerShell Profile",
    "x_mitre_is_subtechnique": true,
    "revoked": false,
    "x_mitre_deprecated": false,
    "description": "Adversaries may gain persistence and elevate privileges by executing malicious content triggered by PowerShell profiles. A PowerShell profile  (<code>profile.ps1</code>) is a script that runs when [PowerShell](https://attack.mitre.org/techniques/T1059/001) starts and can be used as a logon script to customize user environments.\n\n[PowerShell](https://attack.mitre.org/techniques/T1059/001) supports several profiles depending on the user or host program. For example, there can be different profiles for [PowerShell](https://attack.mitre.org/techniques/T1059/001) host programs such as the PowerShell console, PowerShell ISE or Visual Studio Code. An administrator can also configure a profile that applies to all users and host programs on the local computer. (Citation: Microsoft About Profiles) \n\nAdversaries may modify these profiles to include arbitrary commands, functions, modules, and/or [PowerShell](https://attack.mitre.org/techniques/T1059/001) drives to gain persistence. Every time a user opens a [PowerShell](https://attack.mitre.org/techniques/T1059/001) session the modified script will be executed unless the <code>-NoProfile</code> flag is used when it is launched. (Citation: ESET Turla PowerShell May 2019) \n\nAn adversary may also be able to escalate privileges if a script in a PowerShell profile is loaded and executed by an account with higher privileges, such as a domain administrator. (Citation: Wits End and Shady PowerShell Profiles)",
    "x_mitre_platforms": [
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_defense_bypassed": [],
    "external_references": [
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1546/013",
            "external_id": "T1546.013"
        },
        {
            "source_name": "Microsoft About Profiles",
            "description": "Microsoft. (2017, November 29). About Profiles. Retrieved June 14, 2019.",
            "url": "https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_profiles?view=powershell-6"
        },
        {
            "source_name": "ESET Turla PowerShell May 2019",
            "description": "Faou, M. and Dumont R.. (2019, May 29). A dive into Turla PowerShell usage. Retrieved June 14, 2019.",
            "url": "https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/"
        },
        {
            "source_name": "Wits End and Shady PowerShell Profiles",
            "description": "DeRyke, A.. (2019, June 7). Lab Notes: Persistence and Privilege Elevation using the Powershell Profile. Retrieved July 8, 2019.",
            "url": "https://witsendandshady.blogspot.com/2019/06/lab-notes-persistence-and-privilege.html"
        },
        {
            "source_name": "Malware Archaeology PowerShell Cheat Sheet",
            "description": "Malware Archaeology. (2016, June). WINDOWS POWERSHELL LOGGING CHEAT SHEET - Win 7/Win 2008 or later. Retrieved June 24, 2016.",
            "url": "http://www.malwarearchaeology.com/s/Windows-PowerShell-Logging-Cheat-Sheet-ver-June-2016-v2.pdf"
        },
        {
            "source_name": "Microsoft Profiles",
            "description": "Microsoft. (2021, September 27). about_Profiles. Retrieved February 4, 2022.",
            "url": "https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_profiles"
        }
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "privilege-escalation"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "persistence"
        }
    ],
    "tactic": [
        "privilege-escalation",
        "persistence"
    ],
    "x_mitre_detection": "Locations where <code>profile.ps1</code> can be stored should be monitored for new profiles or modifications. (Citation: Malware Archaeology PowerShell Cheat Sheet)(Citation: Microsoft Profiles) Example profile locations (user defaults as well as program-specific) include:\n\n* <code>$PsHome\\Profile.ps1</code>\n* <code>$PsHome\\Microsoft.{HostProgram}_profile.ps1</code>\n* <code>$Home\\\\\\[My ]Documents\\PowerShell\\Profile.ps1</code>\n* <code>$Home\\\\\\[My ]Documents\\PowerShell\\Microsoft.{HostProgram}_profile.ps1</code>\n\nMonitor abnormal PowerShell commands, unusual loading of PowerShell drives or modules, and/or execution of unknown programs.",
    "x_mitre_data_sources": [
        "Command: Command Execution",
        "Process: Process Creation",
        "File: File Creation",
        "File: File Modification"
    ],
    "x_mitre_permissions_required": [
        "User",
        "Administrator"
    ],
    "x_mitre_effective_permissions": [],
    "x_mitre_system_requirements": [],
    "x_mitre_remote_support": false,
    "relation": {
        "mitigates": [
            {
                "name": "Code Signing",
                "description": "Enforce binary and application integrity with digital signature verification to prevent untrusted code from executing.",
                "type": "course-of-action",
                "id": "M1045"
            },
            {
                "name": "Restrict File and Directory Permissions",
                "description": "Restrict access by setting directory and file permissions that are not specific to users or privileged accounts.",
                "type": "course-of-action",
                "id": "M1022"
            },
            {
                "name": "Software Configuration",
                "description": "Implement configuration changes to software (other than the operating system) to mitigate security risks associated to how the software operates.",
                "type": "course-of-action",
                "id": "M1054"
            }
        ]
    },
    "mitigationRequirements": {
        "requirements": [
            {
                "description": "Ensure that only signed PowerShell scripts are executed",
                "acid": "98580723"
            },
            {
                "description": "Ensure that profiles are signed to avoid them from being modified",
                "acid": "98580724"
            },
            {
                "description": "Ensure that PowerShell profiles are immutable",
                "acid": "98580725"
            },
            {
                "description": "Ensure that PowerShell profiles are only changeable by certain administrators",
                "acid": "98580726"
            },
            {
                "description": "Ensure that PowerShell profiles are avoided if not required",
                "acid": "98580727"
            },
            {
                "description": "Ensure that -No Profile flag is used when executing PowerShell scripts remotely",
                "acid": "98580728"
            }
        ]
    },
    "detectionRequirements": {
        "requirements": [
            {
                "description": "Ensure that Locations, where profile.ps1 can be stored, should be monitored",
                "acid": "98580715"
            },
            {
                "description": "Ensure that $PsHome\\Profile.ps1 is monitored for new profiles or modifications",
                "acid": "98580716"
            },
            {
                "description": "Ensure that $PsHome\\Microsoft.{{HostProgram}}_profile.ps1 is monitored for new profiles or modifications",
                "acid": "98580717"
            },
            {
                "description": "Ensure that $Home\\My Documents\\PowerShell\\Profile.ps1 is monitored for new profiles or modifications",
                "acid": "98580718"
            },
            {
                "description": "Ensure that $Home\\My Documents\\PowerShell\\Microsoft.{{HostProgram}}_profile.ps1 is monitored for new profiles or modifications",
                "acid": "98580719"
            },
            {
                "description": "Ensure that abnormal or unusual PowerShell commands are monitored",
                "acid": "98580720"
            },
            {
                "description": "Ensure that unusual loading of PowerShell drives or modules are monitored",
                "acid": "98580721"
            },
            {
                "description": "Ensure that the execution of unknown programs is monitored",
                "acid": "98580722"
            }
        ]
    },
    "cspcontrolIds": [],
    "externalcontrolIds": [],
    "peoplecontrolIds": [],
    "policycontrolIds": [],
    "technologycontrolIds": [],
    "cveIds": []
}
