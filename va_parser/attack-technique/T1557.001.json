{
    "id": "T1557.001",
    "name": "LLMNR/NBT-NS Poisoning and SMB Relay",
    "x_mitre_is_subtechnique": true,
    "revoked": false,
    "x_mitre_deprecated": false,
    "description": "By responding to LLMNR/NBT-NS network traffic, adversaries may spoof an authoritative source for name resolution to force communication with an adversary controlled system. This activity may be used to collect or relay authentication materials. \n\nLink-Local Multicast Name Resolution (LLMNR) and NetBIOS Name Service (NBT-NS) are Microsoft Windows components that serve as alternate methods of host identification. LLMNR is based upon the Domain Name System (DNS) format and allows hosts on the same local link to perform name resolution for other hosts. NBT-NS identifies systems on a local network by their NetBIOS name. (Citation: Wikipedia LLMNR)(Citation: TechNet NetBIOS)\n\nAdversaries can spoof an authoritative source for name resolution on a victim network by responding to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know the identity of the requested host, effectively poisoning the service so that the victims will communicate with the adversary controlled system. If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can then collect the hash information sent over the wire through tools that monitor the ports for traffic or through [Network Sniffing](https://attack.mitre.org/techniques/T1040) and crack the hashes offline through [Brute Force](https://attack.mitre.org/techniques/T1110) to obtain the plaintext passwords.\n\nIn some cases where an adversary has access to a system that is in the authentication path between systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv2 hashes can be intercepted and relayed to access and execute code against a target system. The relay step can happen in conjunction with poisoning but may also be independent of it.(Citation: byt3bl33d3r NTLM Relaying)(Citation: Secure Ideas SMB Relay) Additionally, adversaries may encapsulate the NTLMv1/v2 hashes into various protocols, such as LDAP, SMB, MSSQL and HTTP, to expand and use multiple services with the valid NTLM response.\u00a0\n\nSeveral tools may be used to poison name services within local networks such as NBNSpoof, Metasploit, and [Responder](https://attack.mitre.org/software/S0174).(Citation: GitHub NBNSpoof)(Citation: Rapid7 LLMNR Spoofer)(Citation: GitHub Responder)",
    "x_mitre_platforms": [
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_defense_bypassed": [],
    "external_references": [
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1557/001",
            "external_id": "T1557.001"
        },
        {
            "source_name": "Rapid7 LLMNR Spoofer",
            "description": "Francois, R. (n.d.). LLMNR Spoofer. Retrieved November 17, 2017.",
            "url": "https://www.rapid7.com/db/modules/auxiliary/spoof/llmnr/llmnr_response"
        },
        {
            "source_name": "GitHub Responder",
            "description": "Gaffie, L. (2016, August 25). Responder. Retrieved November 17, 2017.",
            "url": "https://github.com/SpiderLabs/Responder"
        },
        {
            "source_name": "Secure Ideas SMB Relay",
            "description": "Kuehn, E. (2018, April 11). Ever Run a Relay? Why SMB Relays Should Be On Your Mind. Retrieved February 7, 2019.",
            "url": "https://blog.secureideas.com/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html"
        },
        {
            "source_name": "TechNet NetBIOS",
            "description": "Microsoft. (n.d.). NetBIOS Name Resolution. Retrieved November 17, 2017.",
            "url": "https://technet.microsoft.com/library/cc958811.aspx"
        },
        {
            "source_name": "GitHub NBNSpoof",
            "description": "Nomex. (2014, February 7). NBNSpoof. Retrieved November 17, 2017.",
            "url": "https://github.com/nomex/nbnspoof"
        },
        {
            "source_name": "GitHub Conveigh",
            "description": "Robertson, K. (2016, August 28). Conveigh. Retrieved November 17, 2017.",
            "url": "https://github.com/Kevin-Robertson/Conveigh"
        },
        {
            "source_name": "byt3bl33d3r NTLM Relaying",
            "description": "Salvati, M. (2017, June 2). Practical guide to NTLM Relaying in 2017 (A.K.A getting a foothold in under 5 minutes). Retrieved February 7, 2019.",
            "url": "https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes.html"
        },
        {
            "source_name": "Sternsecurity LLMNR-NBTNS",
            "description": "Sternstein, J. (2013, November). Local Network Attacks: LLMNR and NBT-NS Poisoning. Retrieved November 17, 2017.",
            "url": "https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning"
        },
        {
            "source_name": "Wikipedia LLMNR",
            "description": "Wikipedia. (2016, July 7). Link-Local Multicast Name Resolution. Retrieved November 17, 2017.",
            "url": "https://en.wikipedia.org/wiki/Link-Local_Multicast_Name_Resolution"
        }
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "credential-access"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "collection"
        }
    ],
    "tactic": [
        "credential-access",
        "collection"
    ],
    "x_mitre_detection": "Monitor <code>HKLM\\Software\\Policies\\Microsoft\\Windows NT\\DNSClient</code> for changes to the \"EnableMulticast\" DWORD value. A value of \u201c0\u201d indicates LLMNR is disabled. (Citation: Sternsecurity LLMNR-NBTNS)\n\nMonitor for traffic on ports UDP 5355 and UDP 137 if LLMNR/NetBIOS is disabled by security policy.\n\nDeploy an LLMNR/NBT-NS spoofing detection tool.(Citation: GitHub Conveigh) Monitoring of Windows event logs for event IDs 4697 and 7045 may help in detecting successful relay techniques.(Citation: Secure Ideas SMB Relay)",
    "x_mitre_data_sources": [
        "Service: Service Creation",
        "Windows Registry: Windows Registry Key Modification",
        "Network Traffic: Network Traffic Flow",
        "Network Traffic: Network Traffic Content"
    ],
    "x_mitre_permissions_required": [],
    "x_mitre_effective_permissions": [],
    "x_mitre_system_requirements": [],
    "x_mitre_remote_support": false,
    "relation": {
        "mitigates": [
            {
                "name": "Disable or Remove Feature or Program",
                "description": "Remove or deny access to unnecessary and potentially vulnerable software to prevent abuse by adversaries.",
                "type": "course-of-action",
                "id": "M1042"
            },
            {
                "name": "Network Intrusion Prevention",
                "description": "Use intrusion detection signatures to block traffic at network boundaries.",
                "type": "course-of-action",
                "id": "M1031"
            },
            {
                "name": "Network Segmentation",
                "description": "Architect sections of the network to isolate critical systems, functions, or resources. Use physical and logical segmentation to prevent access to potentially sensitive systems and information. Use a DMZ to contain any internet-facing services that should not be exposed from the internal network. Configure separate virtual private cloud (VPC) instances to isolate critical cloud systems.",
                "type": "course-of-action",
                "id": "M1030"
            },
            {
                "name": "Filter Network Traffic",
                "description": "Use network appliances to filter ingress or egress traffic and perform protocol-based filtering. Configure software on endpoints to filter network traffic.",
                "type": "course-of-action",
                "id": "M1037"
            }
        ]
    },
    "mitigationRequirements": {
        "requirements": [
            {
                "description": "Ensure that LLMNR and NetBIOS are configured to be disabled by group policy",
                "acid": "98581894"
            },
            {
                "description": "Ensure that the host-based firewall solution is configured to block LLMNR/NetBIOS traffic",
                "acid": "98581895"
            },
            {
                "description": "Ensure that SMB Signing is enabled to prevent NTLMv2 relay attacks",
                "acid": "98581896"
            },
            {
                "description": "Ensure that Network Intrusion Detection and Prevention systems are configured to identify MiTM activity patterns on the network",
                "acid": "98581897"
            },
            {
                "description": "Ensure that Network segmentation is implemented to isolate the network components that do not require access to the external network",
                "acid": "98581898"
            }
        ]
    },
    "detectionRequirements": {
        "requirements": [
            {
                "description": "Ensure that HKLM\\Software\\Policies\\Microsoft\\Windows NT\\DNSClient are monitored for changes to \"EnableMulticast\" DWORD value in the registry",
                "acid": "98581890"
            },
            {
                "description": "Ensure that network traffic on UDP ports of 5355 and 137 are monitored",
                "acid": "98581891"
            },
            {
                "description": "Ensure that LLMNR/NBT-NS spoofing detection tools are configured to detect LLMNR/NBT-NS Poisoning",
                "acid": "98581892"
            },
            {
                "description": "Ensure that Windows event logs for Event IDS 4697 and 7045 are monitored for detecting relay techniques",
                "acid": "98581893"
            }
        ]
    },
    "cspcontrolIds": [
        "40000020",
        "40000182",
        "40000513",
        "40000515",
        "40000523"
    ],
    "externalcontrolIds": [],
    "peoplecontrolIds": [],
    "policycontrolIds": [
        "50100613",
        "50100619",
        "50100621",
        "50100674",
        "50100675",
        "50100677",
        "50101933",
        "50104118"
    ],
    "technologycontrolIds": [
        "16010462",
        "16020472",
        "16100199",
        "16100514",
        "16110449",
        "16120467",
        "16360208",
        "16460206",
        "19920439",
        "19920450",
        "19920460",
        "19920470",
        "19920478"
    ],
    "cveIds": []
}
