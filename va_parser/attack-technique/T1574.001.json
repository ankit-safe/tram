{
    "id": "T1574.001",
    "name": "DLL Search Order Hijacking",
    "x_mitre_is_subtechnique": true,
    "revoked": false,
    "x_mitre_deprecated": false,
    "description": "Adversaries may execute their own malicious payloads by hijacking the search order used to load DLLs. Windows systems use a common method to look for required DLLs to load into a program. (Citation: Microsoft Dynamic Link Library Search Order)(Citation: FireEye Hijacking July 2010) Hijacking DLL loads may be for the purpose of establishing persistence as well as elevating privileges and/or evading restrictions on file execution.\n\nThere are many ways an adversary can hijack DLL loads. Adversaries may plant trojan dynamic-link library files (DLLs) in a directory that will be searched before the location of a legitimate library that will be requested by a program, causing Windows to load their malicious library when it is called for by the victim program. Adversaries may also perform DLL preloading, also called binary planting attacks, (Citation: OWASP Binary Planting) by placing a malicious DLL with the same name as an ambiguously specified DLL in a location that Windows searches before the legitimate DLL. Often this location is the current working directory of the program.(Citation: FireEye fxsst June 2011) Remote DLL preloading attacks occur when a program sets its current directory to a remote location such as a Web share before loading a DLL. (Citation: Microsoft Security Advisory 2269637)\n\nAdversaries may also directly modify the search order via DLL redirection, which after being enabled (in the Registry and creation of a redirection file) may cause a program to load a different DLL.(Citation: Microsoft Dynamic-Link Library Redirection)(Citation: Microsoft Manifests)(Citation: FireEye DLL Search Order Hijacking)\n\nIf a search order-vulnerable program is configured to run at a higher privilege level, then the adversary-controlled DLL that is loaded will also be executed at the higher level. In this case, the technique could be used for privilege escalation from user to administrator or SYSTEM or from administrator to SYSTEM, depending on the program. Programs that fall victim to path hijacking may appear to behave normally because malicious DLLs may be configured to also load the legitimate DLLs they were meant to replace.",
    "x_mitre_platforms": [
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_defense_bypassed": [],
    "external_references": [
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1574/001",
            "external_id": "T1574.001"
        },
        {
            "source_name": "capec",
            "url": "https://capec.mitre.org/data/definitions/471.html",
            "external_id": "CAPEC-471"
        },
        {
            "source_name": "Microsoft Dynamic Link Library Search Order",
            "description": "Microsoft. (2018, May 31). Dynamic-Link Library Search Order. Retrieved November 30, 2014.",
            "url": "https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order?redirectedfrom=MSDN"
        },
        {
            "source_name": "FireEye Hijacking July 2010",
            "description": "Harbour, N. (2010, July 15). Malware Persistence without the Windows Registry. Retrieved November 17, 2020.",
            "url": "https://www.fireeye.com/blog/threat-research/2010/07/malware-persistence-windows-registry.html"
        },
        {
            "source_name": "OWASP Binary Planting",
            "description": "OWASP. (2013, January 30). Binary planting. Retrieved June 7, 2016.",
            "url": "https://www.owasp.org/index.php/Binary_planting"
        },
        {
            "source_name": "FireEye fxsst June 2011",
            "description": "Harbour, N. (2011, June 3). What the fxsst?. Retrieved November 17, 2020.",
            "url": "https://www.fireeye.com/blog/threat-research/2011/06/fxsst.html"
        },
        {
            "source_name": "Microsoft Security Advisory 2269637",
            "description": "Microsoft. (, May 23). Microsoft Security Advisory 2269637. Retrieved March 13, 2020.",
            "url": "https://docs.microsoft.com/en-us/security-updates/securityadvisories/2010/2269637"
        },
        {
            "source_name": "Microsoft Dynamic-Link Library Redirection",
            "description": "Microsoft. (2018, May 31). Dynamic-Link Library Redirection. Retrieved March 13, 2020.",
            "url": "https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-redirection?redirectedfrom=MSDN"
        },
        {
            "source_name": "Microsoft Manifests",
            "description": "Microsoft. (n.d.). Manifests. Retrieved December 5, 2014.",
            "url": "https://msdn.microsoft.com/en-US/library/aa375365"
        },
        {
            "source_name": "FireEye DLL Search Order Hijacking",
            "description": "Nick Harbour. (2010, September 1). DLL Search Order Hijacking Revisited. Retrieved March 13, 2020.",
            "url": "https://www.fireeye.com/blog/threat-research/2010/08/dll-search-order-hijacking-revisited.html"
        }
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "persistence"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "privilege-escalation"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "defense-evasion"
        }
    ],
    "tactic": [
        "persistence",
        "privilege-escalation",
        "defense-evasion"
    ],
    "x_mitre_detection": "Monitor file systems for moving, renaming, replacing, or modifying DLLs. Changes in the set of DLLs that are loaded by a process (compared with past behavior) that do not correlate with known software, patches, etc., are suspicious. Monitor DLLs loaded into a process and detect DLLs that have the same file name but abnormal paths. Modifications to or creation of `.manifest` and `.local` redirection files that do not correlate with software updates are suspicious.",
    "x_mitre_data_sources": [
        "File: File Modification",
        "Module: Module Load",
        "File: File Creation"
    ],
    "x_mitre_permissions_required": [],
    "x_mitre_effective_permissions": [],
    "x_mitre_system_requirements": [],
    "x_mitre_remote_support": false,
    "relation": {
        "mitigates": [
            {
                "name": "Execution Prevention",
                "description": "Block execution of code on a system through application control, and/or script blocking.",
                "type": "course-of-action",
                "id": "M1038"
            },
            {
                "name": "Restrict Library Loading",
                "description": "Prevent abuse of library loading mechanisms in the operating system and software to load untrusted code by configuring appropriate library loading mechanisms and investigating potential vulnerable software.",
                "type": "course-of-action",
                "id": "M1044"
            },
            {
                "name": "Audit",
                "description": "Perform audits or scans of systems, permissions, insecure software, insecure configurations, etc. to identify potential weaknesses.",
                "type": "course-of-action",
                "id": "M1047"
            }
        ]
    },
    "mitigationRequirements": {
        "requirements": [
            {
                "description": "Ensure that auditing tools are deployed to detect DLL search order hijacking opportunities on systems within an enterprise and correct them",
                "acid": "98580853"
            },
            {
                "description": "Ensure that PowerSploit framework Toolkits are deployed to explore systems for DLL hijacking weaknesses",
                "acid": "98580854"
            },
            {
                "description": "Ensure that application whitelisting solutions are implemented to identify and block potentially malicious software executed through search order hijacking",
                "acid": "98580855"
            },
            {
                "description": "Ensure that application whitelisting solutions are implemented to block DLLs loaded by legitimate software",
                "acid": "98580856"
            },
            {
                "description": "Ensure that the loading of remote DLLs is disallowed",
                "acid": "98580857"
            },
            {
                "description": "Ensure that Safe DLL Search Mode is enabled via group policy to force search for system DLLs in directories with greater restrictions",
                "acid": "98580858"
            }
        ]
    },
    "detectionRequirements": {
        "requirements": [
            {
                "description": "Ensure that the file system is monitored for moving, renaming, replacing, or modifying DLLs",
                "acid": "98580848"
            },
            {
                "description": "Ensure that changes in DLLs loaded by a process that does not correlate with known software, patches are monitored",
                "acid": "98580849"
            },
            {
                "description": "Ensure that DLLs loaded into a process are monitored for DLLs having the same file name with abnormal paths",
                "acid": "98580850"
            },
            {
                "description": "Ensure that creation of .manifest and .local redirection files that do not correlate with software updates are monitored",
                "acid": "98580851"
            },
            {
                "description": "Ensure that modifications to .manifest and .local redirection files that do not correlate with software updates are monitored",
                "acid": "98580852"
            }
        ]
    },
    "cspcontrolIds": [],
    "externalcontrolIds": [],
    "peoplecontrolIds": [],
    "policycontrolIds": [],
    "technologycontrolIds": [],
    "cveIds": [
        "CVE-2009-0238",
        "CVE-2018-10657",
        "CVE-2019-10971"
    ]
}
