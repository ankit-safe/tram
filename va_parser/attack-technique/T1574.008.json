{
    "id": "T1574.008",
    "name": "Path Interception by Search Order Hijacking",
    "x_mitre_is_subtechnique": true,
    "revoked": false,
    "x_mitre_deprecated": false,
    "description": "Adversaries may execute their own malicious payloads by hijacking the search order used to load other programs. Because some programs do not call other programs using the full path, adversaries may place their own file in the directory where the calling program is located, causing the operating system to launch their malicious software at the request of the calling program.\n\nSearch order hijacking occurs when an adversary abuses the order in which Windows searches for programs that are not given a path. Unlike [DLL Search Order Hijacking](https://attack.mitre.org/techniques/T1574/001), the search order differs depending on the method that is used to execute the program. (Citation: Microsoft CreateProcess) (Citation: Windows NT Command Shell) (Citation: Microsoft WinExec) However, it is common for Windows to search in the directory of the initiating program before searching through the Windows system directory. An adversary who finds a program vulnerable to search order hijacking (i.e., a program that does not specify the path to an executable) may take advantage of this vulnerability by creating a program named after the improperly specified program and placing it within the initiating program's directory.\n\nFor example, \"example.exe\" runs \"cmd.exe\" with the command-line argument <code>net user</code>. An adversary may place a program called \"net.exe\" within the same directory as example.exe, \"net.exe\" will be run instead of the Windows system utility net. In addition, if an adversary places a program called \"net.com\" in the same directory as \"net.exe\", then <code>cmd.exe /C net user</code> will execute \"net.com\" instead of \"net.exe\" due to the order of executable extensions defined under PATHEXT. (Citation: Microsoft Environment Property)\n\nSearch order hijacking is also a common practice for hijacking DLL loads and is covered in [DLL Search Order Hijacking](https://attack.mitre.org/techniques/T1574/001).",
    "x_mitre_platforms": [
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_defense_bypassed": [],
    "external_references": [
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1574/008",
            "external_id": "T1574.008"
        },
        {
            "source_name": "capec",
            "url": "https://capec.mitre.org/data/definitions/159.html",
            "external_id": "CAPEC-159"
        },
        {
            "source_name": "Microsoft CreateProcess",
            "description": "Microsoft. (n.d.). CreateProcess function. Retrieved December 5, 2014.",
            "url": "http://msdn.microsoft.com/en-us/library/ms682425"
        },
        {
            "source_name": "Windows NT Command Shell",
            "description": "Tim Hill. (2014, February 2). The Windows NT Command Shell. Retrieved December 5, 2014.",
            "url": "https://docs.microsoft.com/en-us/previous-versions//cc723564(v=technet.10)?redirectedfrom=MSDN#XSLTsection127121120120"
        },
        {
            "source_name": "Microsoft WinExec",
            "description": "Microsoft. (n.d.). WinExec function. Retrieved December 5, 2014.",
            "url": "http://msdn.microsoft.com/en-us/library/ms687393"
        },
        {
            "source_name": "Microsoft Environment Property",
            "description": "Microsoft. (2011, October 24). Environment Property. Retrieved July 27, 2016.",
            "url": "https://docs.microsoft.com/en-us/previous-versions//fd7hxfdd(v=vs.85)?redirectedfrom=MSDN"
        }
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "persistence"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "privilege-escalation"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "defense-evasion"
        }
    ],
    "tactic": [
        "persistence",
        "privilege-escalation",
        "defense-evasion"
    ],
    "x_mitre_detection": "Monitor file creation for files named after partial directories and in locations that may be searched for common processes through the environment variable, or otherwise should not be user writable. Monitor the executing process for process executable paths that are named for partial directories. Monitor file creation for programs that are named after Windows system programs or programs commonly executed without a path (such as \"findstr,\" \"net,\" and \"python\"). If this activity occurs outside of known administration activity, upgrades, installations, or patches, then it may be suspicious.\n\nData and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as network connections made for Command and Control, learning details about the environment through Discovery, and Lateral Movement.\n",
    "x_mitre_data_sources": [
        "File: File Creation",
        "Process: Process Creation",
        "File: File Modification"
    ],
    "x_mitre_permissions_required": [
        "Administrator",
        "User",
        "SYSTEM"
    ],
    "x_mitre_effective_permissions": [
        "Administrator",
        "SYSTEM",
        "User"
    ],
    "x_mitre_system_requirements": [],
    "x_mitre_remote_support": false,
    "relation": {
        "mitigates": [
            {
                "name": "Execution Prevention",
                "description": "Block execution of code on a system through application control, and/or script blocking.",
                "type": "course-of-action",
                "id": "M1038"
            },
            {
                "name": "Restrict File and Directory Permissions",
                "description": "Restrict access by setting directory and file permissions that are not specific to users or privileged accounts.",
                "type": "course-of-action",
                "id": "M1022"
            },
            {
                "name": "Audit",
                "description": "Perform audits or scans of systems, permissions, insecure software, insecure configurations, etc. to identify potential weaknesses.",
                "type": "course-of-action",
                "id": "M1047"
            }
        ]
    },
    "mitigationRequirements": {
        "requirements": [
            {
                "description": "Ensure that program configuration files, scripts, the PATH environment variable, services are audited for path interception weaknesses",
                "acid": "98580838"
            },
            {
                "description": "Ensure that old Windows Registry keys are cleaned up when the software is uninstalled",
                "acid": "98580839"
            },
            {
                "description": "Ensure that systems are periodically searched for and corrected or reported path interception weaknesses",
                "acid": "98580840"
            },
            {
                "description": "Ensure that application whitelisting tools are deployed to identify and block potentially malicious software executed path interception",
                "acid": "98580841"
            },
            {
                "description": "Ensure that the Windows Defender Application Control tool is configured to identify and block potentially malicious software executed path interception",
                "acid": "98580842"
            },
            {
                "description": "Ensure that AppLocker is configured to identify and block potentially malicious software executed path interception",
                "acid": "98580843"
            },
            {
                "description": "Ensure that Software Restriction Policies are implemented to identify and block potentially malicious software executed path interception",
                "acid": "98580844"
            },
            {
                "description": "Ensure that all executables are placed in write-protected directories",
                "acid": "98580845"
            },
            {
                "description": "Ensure that proper permissions and directory access control are set to deny users the ability to write files to the top-level directory C:",
                "acid": "98580846"
            },
            {
                "description": "Ensure that proper permissions and directory access control are set to deny users the ability to write files to system directories, such as C:\\Windows\\",
                "acid": "98580847"
            }
        ]
    },
    "detectionRequirements": {
        "requirements": [
            {
                "description": "Ensure that file creation is monitored for files named after partial directories",
                "acid": "98580832"
            },
            {
                "description": "Ensure that file creation is monitored for files in locations that may be searched for common processes through the environment variable",
                "acid": "98580833"
            },
            {
                "description": "Ensure that file creation is monitored for files that are not user-writable",
                "acid": "98580834"
            },
            {
                "description": "Ensure that executing processes are monitored for process executable paths that are named for partial directories",
                "acid": "98580835"
            },
            {
                "description": "Ensure that the file creation process is monitored for programs that are named after Windows system programs",
                "acid": "98580836"
            },
            {
                "description": "Ensure that the file creation process is monitored for programs commonly executed without a path (such as \"findstr,\" \"net,\" and \"python\")",
                "acid": "98580837"
            }
        ]
    },
    "cspcontrolIds": [],
    "externalcontrolIds": [],
    "peoplecontrolIds": [],
    "policycontrolIds": [],
    "technologycontrolIds": [],
    "cveIds": [
        "CVE-2012-1854",
        "CVE-2018-11049",
        "CVE-2019-1794"
    ]
}
